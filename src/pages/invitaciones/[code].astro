---
import Layout from "@/layouts/Layout.astro";
import InvitationCard from "@/components/InvitationCard.astro";
import { turso } from '@/turso'

const { code } = Astro.params;

const invitationResult = await turso.execute(`
  SELECT id FROM invitations WHERE code = '${code}' LIMIT 1`);

if (invitationResult.rows.length === 0) {
  throw new Error("Invitaci√≥n no encontrada");
}

const invitationId = Number(invitationResult.rows[0].id);

const guestsResult = await turso.execute(`
  SELECT id, name, status FROM guests WHERE invitation_id = '${invitationId}'`);

const guests = guestsResult.rows;
---

<Layout title="Jennifer & Alejandro | Invitaciones">
  <InvitationCard invitationId={invitationId} code={code} guests={guests} />
</Layout>
